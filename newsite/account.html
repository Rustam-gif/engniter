<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Account · Engniter</title>
<meta name="description" content="Manage your Engniter account.">
<link rel="icon" href="assets/favicon.png"><link rel="stylesheet" href="assets/styles.css">
<meta property="og:title" content="My Account · Engniter"><meta property="og:description" content="Manage your Engniter account."><meta property="og:image" content="assets/logo.png">
<meta name="theme-color" content="#f06736">
<script type="application/ld+json">
{"@context": "https://schema.org", "@type": "Organization", "name": "Engniter", "url": "https://engniter.com", "logo": "assets/logo.png"}
</script>
<!-- GoTrue.js for custom authentication -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script src="https://unpkg.com/@supabase/gotrue-js@2.62.0/dist/umd/gotrue.js"></script>
<script src="assets/auth.js"></script>
</head>
<body>
<a class="skip" href="#content">Skip to content</a>
<header class="nav" role="banner">
  <div class="container inner">
    <a class="brand" href="index.html" aria-label="Engniter home">
      <img src="assets/logo.png" alt="Engniter logo"><span>ENGNITER</span>
    </a>
    <nav aria-label="Primary">
      <ul>
        <li><a href="lessons.html">Lessons</a></li>
        <li><a href="pricing.html">Pricing</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="account.html" id="account-nav">Account</a></li>
        <li><a class="cta" href="login.html" id="signin-nav">Sign In</a></li>
      </ul>
    </nav>
  </div>
</header>

<main id="content" class="container">
  <!-- Loading state -->
  <div id="loading-state">
    <div class="auth-message">
      <p>Loading your account...</p>
    </div>
  </div>

  <!-- Authentication check - redirect if not logged in -->
  <div id="auth-check" class="hidden">
    <div class="auth-message">
      <p>Please log in to access your account.</p>
      <a href="login.html" class="btn">Go to Login</a>
    </div>
  </div>

  <!-- Account content - only visible when logged in -->
  <div id="account-content" class="hidden">
    <section class="hero">
      <div>
        <span class="badge">Account</span>
        <h1>Welcome, <span id="user-full-name">User</span>!</h1>
        <p>Here's your account information and settings.</p>
      </div>
      <div class="art"><img src="assets/logo.png" alt="Engniter mascot"></div>
    </section>

    <section aria-labelledby="profile" class="account-section">
      <h2 id="profile" class="h3">Profile Information</h2>
      <div class="user-info">
        <div class="info-item">
          <strong>Full Name:</strong> <span id="user-name">Loading...</span>
        </div>
        <div class="info-item">
          <strong>Email:</strong> <span id="user-email">Loading...</span>
        </div>
        <div class="info-item">
          <strong>Verified:</strong> <span id="user-verified">Loading...</span>
        </div>
        <div class="info-item">
          <strong>Account Created:</strong> <span id="user-created">Loading...</span>
        </div>
        <div class="info-item">
          <strong>Sign-in Method:</strong> <span id="user-provider">Loading...</span>
        </div>
      </div>
    </section>

    <section aria-labelledby="actions" class="account-section">
      <h2 id="actions" class="h3">Account Actions</h2>
      <div class="stack">
        <button id="logout-btn" class="btn delete-account">Log Out</button>
        <p class="fine">Click here to sign out of your account and return to the login page.</p>
      </div>
    </section>

    <section aria-labelledby="navigation" class="account-section">
      <h2 id="navigation" class="h3">Quick Navigation</h2>
      <div class="stack">
        <a href="lessons.html" class="btn">Browse Lessons</a>
        <a href="pricing.html" class="btn" style="background: var(--muted);">View Pricing</a>
        <a href="about.html" class="btn" style="background: var(--muted);">About Us</a>
      </div>
    </section>
  </div>
</main>

<footer class="footer" role="contentinfo">
  <div class="container inner">
    <div>© 2025 Engniter • Ignite your English</div>
    <div><a href="account.html">Account</a> · <a href="about.html#faq">FAQ</a></div>
  </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function(){
  Auth.init();

  const loadingState = document.getElementById('loading-state');
  const authCheck = document.getElementById('auth-check');
  const accountContent = document.getElementById('account-content');
  const logoutBtn = document.getElementById('logout-btn');
  const userFullName = document.getElementById('user-full-name');
  const userName = document.getElementById('user-name');
  const userEmail = document.getElementById('user-email');
  const userCreated = document.getElementById('user-created');
  const userProvider = document.getElementById('user-provider');
  const userVerified = document.getElementById('user-verified');

  function hideLoading(){ loadingState.classList.add('hidden'); }
  function showAuth(){ hideLoading(); authCheck.classList.remove('hidden'); accountContent.classList.add('hidden'); }
  function showAccount(){ hideLoading(); authCheck.classList.add('hidden'); accountContent.classList.remove('hidden'); }

  // Handle OAuth callback and refresh nav
  Auth.handleOAuthCallback();

  let user = Auth.requireAccountPage();
  if (!user) return;
  // If using identity widget, prefer richer identity object
  if (window.netlifyIdentity && typeof window.netlifyIdentity.currentUser === 'function'){
    const idUser = window.netlifyIdentity.currentUser();
    if (idUser) user = idUser;
  }
  showAccount();

  // Populate
  const fullName = (user.user_metadata && user.user_metadata.full_name) || user.full_name || user.email || 'User';
  if (userFullName) userFullName.textContent = fullName;
  if (userName) userName.textContent = (user.user_metadata && user.user_metadata.full_name) || user.full_name || 'Not available';
  if (userEmail) userEmail.textContent = user.email || user.email_verified || 'Not available';
  if (userCreated){
    const createdAtRaw = user.created_at || (user.user_metadata && user.user_metadata.created_at) || user.confirmed_at;
    const createdAt = createdAtRaw ? new Date(createdAtRaw) : new Date();
    userCreated.textContent = createdAt.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  if (userProvider){
    const provider = (user.app_metadata && user.app_metadata.provider) || (user.user_metadata && user.user_metadata.provider) || user.provider || 'email';
    userProvider.textContent = provider.charAt(0).toUpperCase() + provider.slice(1);
  }
  if (userVerified){
    const verified = Auth.isEmailConfirmed(user);
    userVerified.textContent = verified ? 'Yes' : 'No';
  }

  // Logout
  if (logoutBtn){ logoutBtn.addEventListener('click', function(){ Auth.logout(); }); }
});
</script>
</body>
</html>
