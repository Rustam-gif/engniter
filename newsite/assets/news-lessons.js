// News Lessons System for Engniter
// Handles news lesson display, filtering, and modal functionality

// Handle missing thumbnail images
function handleImageError(img) {
    img.style.display = 'none';
    const parent = img.parentElement;
    const fallback = document.createElement('div');
    fallback.className = 'news-image-fallback';
    fallback.innerHTML = `
        <div class="fallback-content">
            <svg viewBox="0 0 24 24" width="48" height="48" fill="currentColor">
                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
            </svg>
            <span>News Image</span>
        </div>
    `;
    parent.appendChild(fallback);
}

// Add error handlers to all news images
document.addEventListener('DOMContentLoaded', function() {
    const newsImages = document.querySelectorAll('.news-image img');
    newsImages.forEach(img => {
        img.addEventListener('error', () => handleImageError(img));
    });
});

// News lesson data
const newsLessons = {
    'soccer-party': {
        title: "Soccer Star's Party Sparks Disability Rights Backlash",
        level: "B1-B2",
        wordCount: "~220",
        date: "July 13, 2025",
        topic: "Sports",
        article: `Lamine Yamal, the electric 18-year-old winger from Barcelona and Spain, threw a huge birthday party on July 13, 2025, surrounded by teammates, celebs, and influencers. But things got awkward fast when a Spanish disability rights group, ADEE, claimed that people with dwarfism were hired as entertainment—and they weren't happy.

ADEE said this kind of act "perpetuates stereotypes, fuels discrimination, and undermines dignity." They plan to take legal and social action. Spain's Ministry of Social Rights also stepped in, urging a full investigation by prosecutors and anti-hate-crime offices to see if disability laws were broken.

One entertainer hit back, saying, "No one disrespected us; we were allowed to work in peace. We're normal people doing what we love, legally."

Yamal—now the proud wearer of the No. 10 shirt at Barça and signed through 2031—hasn't made a public comment yet about the controversy.`,
        vocabulary: [
            { term: "Perpetuate", definition: "To keep something going (usually something bad or unfair)", example: "Bad habits perpetuate poor health." },
            { term: "Stereotype", definition: "A fixed idea that doesn't reflect true diversity", example: "Don't stereotype people by their appearance." },
            { term: "Dignity", definition: "Being respected and valued as a person", example: "Everyone deserves to be treated with dignity." },
            { term: "Legal action", definition: "Using the law or courts to resolve a problem", example: "The company took legal action against the thief." },
            { term: "Investigation", definition: "Official checking to see if rules were broken", example: "Police started an investigation into the crime." },
            { term: "We're normal", definition: "We are just regular people—expressing equality", example: "We're normal people doing what we love." }
        ],
        comprehension: [
            { question: "Lamine Yamal is a soccer player for Barcelona and Spain.", answer: "True", type: "TF" },
            { question: "The party controversy involved hiring people with dwarfism as entertainment.", answer: "True", type: "TF" },
            { question: "ADEE is a Spanish disability rights group.", answer: "True", type: "TF" },
            { question: "Yamal has publicly apologized for the controversy.", answer: "False", type: "TF" },
            { question: "The entertainers hired for the party were happy with their treatment.", answer: "True", type: "TF" }
        ],
        discussion: [
            "Is hiring people based on physical traits respectful entertainment—or disrespectful? Why?",
            "When a public figure is involved, does the impact feel bigger? How?",
            "What's a fair way for performers to earn a living while staying respectful of others' rights?",
            "If you were organizing a party, how would you decide what's appropriate?"
        ],
        source: "Sky News coverage and other reports"
    },
    
    'ai-lawyer': {
        title: "Lawyer Apologizes After Fake AI Citations Delay Murder Trial",
        level: "B1-B2",
        wordCount: "~220",
        date: "August 2025",
        topic: "Technology",
        article: `A senior Australian lawyer, Rishi Nathwani KC, apologized to Judge James Elliott in the Supreme Court of Victoria after filing court documents in a murder case containing fake legislative quotes and references to nonexistent rulings—all generated by AI. These errors delayed the trial by one day. The defendant—a teenager who can't be named—was later found not guilty by reason of mental impairment.

Judge Elliott said AI tools can be helpful, but anything they produce must be independently verified. He also pointed out that guidelines already warn lawyers about relying blindly on AI. In this case, both sides failed to catch the fake citations before submitting them.

Similar AI mix-ups have happened elsewhere. In the U.S., some lawyers were fined for submitting fake AI-made case law. In the U.K., judges warned that using false material could be contempt of court or even perverting the course of justice.`,
        vocabulary: [
            { term: "King's Counsel (KC)", definition: "A senior, top-tier lawyer honored by the monarch", example: "She was appointed King's Counsel for her excellent work." },
            { term: "Submissions", definition: "Documents lawyers give to the court", example: "The lawyer prepared his submissions carefully." },
            { term: "Fabricated", definition: "Made up—false but presented as real", example: "The evidence was fabricated and not authentic." },
            { term: "Verified", definition: "Checked carefully to make sure it's accurate", example: "All facts must be verified before publishing." },
            { term: "Contempt of court", definition: "Breaking or disrespecting court rules—punishable", example: "The judge found him in contempt of court." },
            { term: "Perverting the course of justice", definition: "Blocking fair legal process—very serious", example: "Lying to police can be perverting the course of justice." }
        ],
        comprehension: [
            { question: "Rishi Nathwani KC is a senior Australian lawyer.", answer: "True", type: "TF" },
            { question: "The AI-generated citations were all accurate and real.", answer: "False", type: "TF" },
            { question: "The trial was delayed because of the fake citations.", answer: "True", type: "TF" },
            { question: "The defendant was found guilty of murder.", answer: "False", type: "TF" },
            { question: "This is the first time AI has caused problems in legal cases.", answer: "False", type: "TF" }
        ],
        discussion: [
            "Why is AI tempting for lawyers—but also risky?",
            "Have you trusted something without checking and regretted it?",
            "Should courts ban AI, regulate it, or embrace it carefully?",
            "If a tool helps but sometimes lies, how would you use it wisely?"
        ],
        source: "AP News"
    },
    
    'whale-fossil': {
        title: "Ancient 'Pokémon-Like' Whale Fossil Found in Australia",
        level: "B1-B2",
        wordCount: "~200",
        date: "August 2025",
        topic: "Science",
        article: `Meet Janjucetus dullardi, a wild new whale species from a 25-million-year-old fossil on Victoria's Jan Juc Beach. Instead of being a gentle giant, this whale was small—about 2–3 meters long—tiny enough to fit on a single bed. But don't be fooled: it had tennis-ball-sized eyes, a shark-like snout, and razor-sharp teeth. Scientists call it "deceptively cute, but definitely not harmless."

The fossil was discovered in 2019 by Ross Dullard, a school principal and fossil fan, who donated it to Museums Victoria. The find is a big breakthrough—it's one of only four known species from the mammalodontid group, early whales that followed a very different path from today's filter-feeding giants.

This discovery gives us a peek at how whales evolved from toothy predators into the peaceful leviathans we know now.`,
        vocabulary: [
            { term: "Deceptively cute", definition: "Looks sweet, but really isn't—kind of tricks you", example: "The kitten was deceptively cute but very aggressive." },
            { term: "Predator", definition: "Animal that hunts and eats other animals", example: "Lions are apex predators in the savanna." },
            { term: "Mammalodontid", definition: "Early, toothy whale group—ancestors of big whales", example: "Mammalodontids lived millions of years ago." },
            { term: "Evolution", definition: "How species change slowly over millions of years", example: "Human evolution took millions of years." },
            { term: "Fossil", definition: "Remains or traces of ancient life preserved in rock", example: "The dinosaur fossil was perfectly preserved." },
            { term: "Juvenile", definition: "Young; not yet fully grown", example: "The juvenile bird couldn't fly yet." }
        ],
        comprehension: [
            { question: "Janjucetus dullardi was a large whale species.", answer: "False", type: "TF" },
            { question: "The fossil is about 25 million years old.", answer: "True", type: "TF" },
            { question: "Ross Dullard is a professional paleontologist.", answer: "False", type: "TF" },
            { question: "This whale had sharp teeth and was a predator.", answer: "True", type: "TF" },
            { question: "Modern whales are filter-feeders, not predators.", answer: "True", type: "TF" }
        ],
        discussion: [
            "What's the coolest (or oddest) prehistoric animal you've heard of—and why?",
            "If this whale looked cute but was dangerous, does that change how you judge appearances?",
            "Why is it important when everyday people help discover fossils?",
            "How do you imagine the oceans looked when little toothy whales ruled?"
        ],
        source: "AP News and science coverage"
    },
    
    'doom-scroller-job': {
        title: "CEO Wants to Hire Full-Time Doom-Scrollers",
        level: "B1-B2",
        wordCount: "~200",
        date: "August 2025",
        topic: "Business",
        article: `Monk Entertainment's CEO in Mumbai, Viraj Sheth, just flipped doom-scrolling—yes, that six-hours-a-day Instagram + Reddit time sink—into a real job. He's looking for someone whose hobby is their superpower: living on social feeds and knowing the latest in creator culture.

To land the gig, you should: spend 6+ hours/day on Instagram/YouTube (proof via screenshots), be up on creator culture and celeb gossip subreddits, and be fluent in English + Hindi (bonus: Excel skills). It's a full-time, Mumbai-based role with a "very competitive" salary—no exact number shared.

Online reactions were mixed: some called it a dream job; others joked they were "overqualified" thanks to scary screen-time stats. If you want to pitch yourself, the application asks for personality and humor—no AI-written cover letters.`,
        vocabulary: [
            { term: "Doom-scrolling", definition: "Endlessly scrolling social media, often through negative news", example: "I spent hours doom-scrolling through bad news." },
            { term: "Creator culture", definition: "The world of influencers, trends, and online content", example: "Creator culture is changing how people make money online." },
            { term: "Competitive salary", definition: "Pay that's better than average", example: "The company offers a competitive salary for the industry." },
            { term: "Obsession", definition: "A very strong interest in something", example: "His obsession with cars started when he was young." },
            { term: "Overqualified", definition: "Having more skills/experience than a job needs", example: "She was overqualified for the entry-level position." },
            { term: "Full-time role", definition: "Regular, 5-day-a-week job—not a side hustle", example: "I'm looking for a full-time role in marketing." }
        ],
        comprehension: [
            { question: "Viraj Sheth is the CEO of Monk Entertainment.", answer: "True", type: "TF" },
            { question: "The job requires spending at least 6 hours per day on social media.", answer: "True", type: "TF" },
            { question: "The salary amount is clearly stated in the job posting.", answer: "False", type: "TF" },
            { question: "Everyone online thought this was a great job opportunity.", answer: "False", type: "TF" },
            { question: "The company accepts AI-written cover letters.", answer: "False", type: "TF" }
        ],
        discussion: [
            "What would you tell your parents if scrolling Instagram could be your job?",
            "Does this fit today's creator-driven world—or go too far?",
            "Would you apply if you could prove elite scrolling skills?",
            "Should jobs like this limit screen time? How would you balance it?"
        ],
        source: "NDTV and related reports"
    },
    
    'area51-jet': {
        title: "Secret Air Force Jet Spotted Over Area 51",
        level: "B1-B2",
        wordCount: "~200",
        date: "August 2025",
        topic: "Technology",
        article: `A rare sighting at Nevada's Groom Lake—better known as Area 51—set aviation Twitter on fire. Photographer Michael Rokita filmed a heavily modified Boeing 737-200 nicknamed RAT55, a U.S. Air Force radar-test aircraft, from Tikaboo Peak about 26 miles away.

The jet reportedly performed touch-and-go maneuvers, landed on Runway 32, and taxied toward Hangar 18—the base's most famous (and mysterious) building. RAT55 is thought to support stealth and radar testing, sometimes flying with its transponder off to avoid easy tracking. The base itself was only officially acknowledged by the U.S. government in 2013, so every new clip fuels more curiosity.

Whether you think it's secret weapons testing or just routine data collection, the video reminded the world that Area 51 is still very much active—and very good at keeping secrets.`,
        vocabulary: [
            { term: "Touch-and-go", definition: "A landing where the plane immediately takes off again", example: "The pilot practiced touch-and-go landings." },
            { term: "Radar testbed", definition: "An aircraft used to test radar systems and stealth tech", example: "The military uses radar testbeds for research." },
            { term: "Transponder", definition: "A device that broadcasts an aircraft's identity/location", example: "The transponder helps air traffic control track planes." },
            { term: "Groom Lake", definition: "The dry lakebed where Area 51's runway complex sits", example: "Groom Lake is in the Nevada desert." },
            { term: "Hangar 18", definition: "A large building at Area 51 often linked with secret projects", example: "Hangar 18 is famous in conspiracy theories." },
            { term: "Classified", definition: "Officially secret information or activity", example: "The documents were classified and confidential." }
        ],
        comprehension: [
            { question: "Area 51 is located in Nevada.", answer: "True", type: "TF" },
            { question: "Michael Rokita photographed the jet from 26 miles away.", answer: "True", type: "TF" },
            { question: "The U.S. government officially acknowledged Area 51 in 2013.", answer: "True", type: "TF" },
            { question: "RAT55 is a passenger aircraft, not a military plane.", answer: "False", type: "TF" },
            { question: "The jet always flies with its transponder on for safety.", answer: "False", type: "TF" }
        ],
        discussion: [
            "Why do places like Area 51 capture people's imaginations?",
            "Should the public know more about secret military testing—why or why not?",
            "What's the line between national security and healthy transparency?",
            "If you were the photographer, would you publish the footage?"
        ],
        source: "New York Post summary and follow-up coverage"
    }
};

// Function to open a news lesson
function openNewsLesson(lessonKey) {
    console.log('Opening news lesson:', lessonKey);
    
    const lesson = newsLessons[lessonKey];
    if (!lesson) {
        console.error('Lesson not found:', lessonKey);
        return;
    }

    console.log('Lesson data:', lesson);

    // Set modal title
    const modalTitle = document.getElementById('modalTitle');
    if (modalTitle) {
        modalTitle.textContent = lesson.title;
    } else {
        console.error('Modal title element not found');
    }

    // Create lesson content
    const lessonContent = createLessonContent(lesson);
    const modalBody = document.getElementById('modalBody');
    if (modalBody) {
        modalBody.innerHTML = lessonContent;
    } else {
        console.error('Modal body element not found');
    }

    // Show modal
    const modal = document.getElementById('newsModal');
    if (modal) {
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
        console.log('Modal should now be visible');
    } else {
        console.error('Modal element not found');
    }
}

// Function to create lesson content
function createLessonContent(lesson) {
    return `
        <div class="news-lesson">
            <div class="lesson-header">
                <div class="lesson-meta">
                    <span class="level">Level: ${lesson.level}</span>
                    <span class="words">Words: ${lesson.wordCount}</span>
                    <span class="date">Date: ${lesson.date}</span>
                </div>
                <div class="lesson-topic">Topic: ${lesson.topic}</div>
            </div>

            <div class="lesson-section">
                <h3>Article</h3>
                <div class="article-text">
                    ${lesson.article.split('\n\n').map(paragraph => `<p>${paragraph}</p>`).join('')}
                </div>
            </div>

            <div class="lesson-section">
                <h3>Vocabulary Preview</h3>
                <div class="vocabulary-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Word/Phrase</th>
                                <th>Meaning</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${lesson.vocabulary.map(vocab => `
                                <tr>
                                    <td><strong>${vocab.term}</strong></td>
                                    <td>${vocab.definition}</td>
                                    <td>${vocab.example}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="lesson-section">
                <h3>Comprehension Check</h3>
                <div class="comprehension-questions">
                    ${lesson.comprehension.map((q, index) => `
                        <div class="question">
                            <p><strong>${index + 1})</strong> ${q.question}</p>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="lesson-section">
                <h3>Answer Key</h3>
                <div class="answer-key">
                    ${lesson.comprehension.map((q, index) => `
                        <span class="answer">${index + 1}) ${q.answer}</span>
                    `).join('  ')}
                </div>
            </div>

            <div class="lesson-section">
                <h3>Discussion Questions</h3>
                <div class="discussion-questions">
                    ${lesson.discussion.map((q, index) => `
                        <div class="question">
                            <p><strong>${index + 1})</strong> ${q}</p>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="lesson-source">
                <p><em>Source:</em> ${lesson.source}</p>
            </div>

            <div class="lesson-actions">
                <button class="btn btn-outline" onclick="printLesson()">Print Lesson</button>
                <button class="btn btn-primary" onclick="closeNewsModal()">Close</button>
            </div>
        </div>
    `;
}

// Function to close news modal
function closeNewsModal() {
    console.log('Closing news modal');
    const modal = document.getElementById('newsModal');
    if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        console.log('Modal should now be hidden');
    } else {
        console.error('Modal element not found for closing');
    }
}

// Function to filter news by level and topic
function filterNews() {
    const levelFilter = document.getElementById('level-filter').value;
    const topicFilter = document.getElementById('topic-filter').value;
    const newsCards = document.querySelectorAll('.news-card');

    newsCards.forEach(card => {
        const level = card.dataset.level;
        const topic = card.dataset.topic;
        
        const levelMatch = levelFilter === 'all' || level === levelFilter;
        const topicMatch = topicFilter === 'all' || topic === topicFilter;
        
        if (levelMatch && topicMatch) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Function to clear filters
function clearFilters() {
    document.getElementById('level-filter').value = 'all';
    document.getElementById('topic-filter').value = 'all';
    
    const newsCards = document.querySelectorAll('.news-card');
    newsCards.forEach(card => {
        card.style.display = 'block';
    });
}

// Function to print lesson
function printLesson() {
    const lessonContent = document.querySelector('.news-lesson');
    if (lessonContent) {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>News Lesson - ${document.getElementById('modalTitle').textContent}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .lesson-section { margin-bottom: 20px; }
                        .vocabulary-table table { border-collapse: collapse; width: 100%; }
                        .vocabulary-table th, .vocabulary-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .question { margin-bottom: 10px; }
                        .answer-key { margin-bottom: 20px; }
                        .answer { margin-right: 15px; }
                        .lesson-source { margin-top: 30px; font-style: italic; }
                    </style>
                </head>
                <body>
                    ${lessonContent.outerHTML}
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('newsModal');
    if (event.target === modal) {
        closeNewsModal();
    }
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeNewsModal();
    }
});
